<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <title>{% block title %}Welcome!{% endblock %}</title>
        <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 128 128%22><text y=%221.2em%22 font-size=%2296%22>⚫️</text><text y=%221.3em%22 x=%220.2em%22 font-size=%2276%22 fill=%22%23fff%22>sf</text></svg>">
        {% block stylesheets %}
            <!-- slider -->
            <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
        
            <!-- styles -->
            <link rel="stylesheet" href="{{ asset('styles/partials.css') }}">
            <link rel="stylesheet" href="{{ asset('styles/app.css') }}">
            <link rel="stylesheet" href="{{ asset('styles/slider.css') }}">
            <link rel="stylesheet" href="{{ asset('styles/cards.css') }}">
            <link rel="stylesheet" href="{{ asset('styles/form.css') }}">
            <link rel="stylesheet" href="{{ asset('styles/flash.css') }}">

            <!-- favicon -->
            <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96" />
            <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
            <link rel="shortcut icon" href="/favicon.ico" />
            <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
            <link rel="manifest" href="/site.webmanifest" />

            <!-- Font Awesome -->
            <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
        {% endblock %}

        {% block javascripts %}
            <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>

            {% block importmap %}{{ importmap('app') }}{% endblock %}
        {% endblock %}
    </head>
    <body>
        {% block header %}
            {% include 'partials/header.html.twig' %}
        {% endblock %}

        {% for label, messages in app.flashes %}
            {% for message in messages %}
                <div class="flash-message flash-{{ label }}" id="flash-{{ loop.index }}">
                    <div class="container">
                        <div class="flash-content">
                            {% if label == 'success' %}
                                <i class="fas fa-check-circle"></i>
                            {% elseif label == 'error' %}
                                <i class="fas fa-exclamation-circle"></i>
                            {% elseif label == 'warning' %}
                                <i class="fas fa-exclamation-triangle"></i>
                            {% elseif label == 'info' %}
                                <i class="fas fa-info-circle"></i>
                            {% endif %}
                            {{ message }}
                        </div>
                        <span class="close-btn" onclick="closeFlash('flash-{{ loop.index }}')">&times;</span>
                    </div>
                </div>
            {% endfor %}
        {% endfor %}

        {% block body %}{% endblock %}

        {% block footer %}
            {% include 'partials/footer.html.twig' %}
        {% endblock %}

        <script>
            document.addEventListener('DOMContentLoaded', function() {
                const closeButtons = document.querySelectorAll('.close-btn');
                closeButtons.forEach(function(btn) {
                    btn.addEventListener('click', function() {
                        this.parentElement.parentElement.style.display = 'none';
                    });
                });

                const form = document.querySelector('.reservation-form');
                
                if (form) {
                    // Добавление маски для ввода даты
                    const dateInput = form.querySelector('input[type="date"]');
                    if (dateInput) {
                        // Установка минимальной даты (сегодня)
                        const today = new Date().toISOString().split('T')[0];
                        dateInput.setAttribute('min', today);
                    }

                    // Валидация формы перед отправкой
                    form.addEventListener('submit', function(event) {
                        let isValid = true;
                        
                        // Проверка email
                        const emailInput = form.querySelector('input[type="email"]');
                        if (emailInput && !validateEmail(emailInput.value)) {
                            showError(emailInput, 'Пожалуйста, введите корректный email');
                            isValid = false;
                        } else {
                            removeError(emailInput);
                        }
                        
                        // Проверка количества участников
                        const peopleInput = form.querySelector('input[name*="amountOfPeople"]');
                        if (peopleInput) {
                            const peopleCount = parseInt(peopleInput.value);
                            if (isNaN(peopleCount) || peopleCount < 1 || peopleCount > 50) {
                                showError(peopleInput, 'Количество участников должно быть от 1 до 50');
                                isValid = false;
                            } else {
                                removeError(peopleInput);
                            }
                        }
                        
                        if (!isValid) {
                            event.preventDefault();
                        }
                    });
                }
                
                // Функция для валидации email
                function validateEmail(email) {
                    const re = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
                    return re.test(String(email).toLowerCase());
                }
                
                // Показать сообщение об ошибке
                function showError(input, message) {
                    removeError(input);
                    const errorDiv = document.createElement('div');
                    errorDiv.className = 'invalid-feedback';
                    errorDiv.innerText = message;
                    input.parentNode.appendChild(errorDiv);
                    input.classList.add('is-invalid');
                }
                
                // Убрать сообщение об ошибке
                function removeError(input) {
                    const errorDiv = input.parentNode.querySelector('.invalid-feedback');
                    if (errorDiv) {
                        errorDiv.remove();
                    }
                    input.classList.remove('is-invalid');
                }

                const flashMessages = document.querySelectorAll('.flash-message');
                flashMessages.forEach(function(message, index) {
                    setTimeout(function() {
                        closeFlash(message.id);
                    }, 5000 + (index * 500));
                });
            });

            function closeFlash(id) {
                const element = document.getElementById(id);
                if (element) {
                    element.style.opacity = '0';
                    element.style.transform = 'translateY(-20px)';
                    element.style.transition = 'opacity 0.3s ease, transform 0.3s ease';
                    
                    setTimeout(function() {
                        element.style.display = 'none';
                    }, 300);
                }
            }
        </script>
    </body>
</html>
