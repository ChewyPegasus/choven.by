{# filepath: d:\prog\php\project\choven.by\templates\dashboard\orders.html.twig #}
{% extends 'base.html.twig' %}

{% block title %}{{ 'admin.orders.title'|trans }}{% endblock %}

{% block head %}
    {% block stylesheets %}
        {{ parent() }}
        <link rel="stylesheet" href="{{ asset('styles/dashboard/orders.css') }}">
    {% endblock %}
{% endblock %}

{% block body %}
    <section class="admin-panel">
        <div class="container">
            <a href="{{ path('app_admin_dashboard') }}" class="back-to-dashboard">
                <i class="fas fa-arrow-left"></i>{{ 'admin.back_to_dashboard'|trans }}
            </a>
            
            <h1 class="admin-title">{{ 'admin.orders.title'|trans }}</h1>

            <div class="orders-header">
                <h3 class="orders-title">
                    <i class="fas fa-shopping-cart"></i>
                    {{ 'admin.orders.manage_orders'|trans }}
                </h3>
                <button class="btn-add-user" onclick="openCreateModal()">
                    <i class="fas fa-plus"></i>
                    {{ 'admin.orders.add_new'|trans }}
                </button>
            </div>
            
            {% if orders|length > 0 %}
                <div class="orders-container">
                    <table class="admin-table">
                        <thead>
                            <tr>
                                <th>{{ 'admin.orders.table.id'|trans }}</th>
                                <th>{{ 'admin.orders.table.email'|trans }}</th>
                                <th>{{ 'admin.orders.table.date'|trans }}</th>
                                <th>{{ 'admin.orders.table.river'|trans }}</th>
                                <th>{{ 'admin.orders.table.package'|trans }}</th>
                                <th>{{ 'admin.orders.table.people_count'|trans }}</th>
                                <th>{{ 'admin.orders.table.duration'|trans }}</th>
                                <th>{{ 'admin.orders.table.actions'|trans }}</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for order in orders %}
                                <tr data-order-id="{{ order.id }}">
                                    <td data-label="{{ 'admin.orders.table.id'|trans }}" class="user-id">#{{ order.id }}</td>
                                    <td data-label="{{ 'admin.orders.table.email'|trans }}" class="user-email">{{ order.email }}</td>
                                    <td data-label="{{ 'admin.orders.table.date'|trans }}">{{ order.startDate|date('d.m.Y') }}</td>
                                    <td data-label="{{ 'admin.orders.table.river'|trans }}">
                                        <span class="badge badge-river">{{ ('river.' ~ order.river.value)|trans }}</span>
                                    </td>
                                    <td data-label="{{ 'admin.orders.table.package'|trans }}">
                                        <span class="badge badge-package">{{ order.package.getLabel()|trans }}</span>
                                    </td>
                                    <td data-label="{{ 'admin.orders.table.people_count'|trans }}">{{ order.amountOfPeople }}</td>
                                    <td data-label="{{ 'admin.orders.table.duration'|trans }}">{{ order.durationDays }}</td>
                                    <td data-label="{{ 'admin.orders.table.actions'|trans }}">
                                        <div class="action-links">
                                            <button class="action-link action-edit" onclick="editOrder({{ order.id }})">
                                                <i class="fas fa-eye"></i>
                                                {{ 'admin.orders.view'|trans }}
                                            </button>
                                            <button class="action-link action-delete" onclick="deleteOrder({{ order.id }})">
                                                <i class="fas fa-trash"></i>
                                                {{ 'admin.orders.delete'|trans }}
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                
                {% if totalPages > 1 %}
                    <div class="pagination">
                        {% if currentPage > 1 %}
                            <a href="{{ path('app_admin_orders', {page: currentPage - 1}) }}"><i class="fas fa-chevron-left"></i> {{ 'admin.pagination.previous'|trans }}</a>
                        {% endif %}
                        {% for page in 1..totalPages %}
                            <a href="{{ path('app_admin_orders', {page: page}) }}" class="{{ page == currentPage ? 'active' : '' }}">{{ page }}</a>
                        {% endfor %}
                        {% if currentPage < totalPages %}
                            <a href="{{ path('app_admin_orders', {page: currentPage + 1}) }}">{{ 'admin.pagination.next'|trans }} <i class="fas fa-chevron-right"></i></a>
                        {% endif %}
                    </div>
                {% endif %}
            {% else %}
                <div class="alert alert-info">
                    <i class="fas fa-info-circle"></i>
                    {{ 'admin.orders.no_orders'|trans }}
                </div>
            {% endif %}
        </div>
    </section>

    <!-- Modal window for viewing/editing order -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">{{ 'admin.orders.modal.edit_title'|trans }}</h3>
                <span class="close-btn" onclick="closeModal('editModal')">&times;</span>
            </div>
            <div class="modal-body">
                <form id="editOrderForm">
                    <p><strong>{{ 'admin.orders.table.email'|trans }}:</strong> <span id="editOrderEmail"></span></p>
                    <p><strong>{{ 'admin.orders.table.date'|trans }}:</strong> <span id="editOrderDate"></span></p>
                    <p><strong>{{ 'admin.orders.table.river'|trans }}:</strong> <span id="editOrderRiver"></span></p>
                    <p><strong>{{ 'admin.orders.table.package'|trans }}:</strong> <span id="editOrderPackage"></span></p>
                    <p><strong>{{ 'admin.orders.table.people_count'|trans }}:</strong> <span id="editOrderPeople"></span></p>
                    <p><strong>{{ 'admin.orders.table.duration'|trans }}:</strong> <span id="editOrderDuration"></span></p>
                    <div class="form-group">
                        <label for="editOrderDescription">{{ 'admin.orders.description'|trans }}</label>
                        <textarea id="editOrderDescription" readonly class="form-control"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn-modal btn-secondary" onclick="closeModal('editModal')">
                    {{ 'admin.users.cancel'|trans }}
                </button>
            </div>
        </div>
    </div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script>
        window.orderUrls = {
            get: "{{ path('app_admin_api_orders_get', {id: '__ID__'}) }}",
            delete: "{{ path('app_admin_api_orders_delete', {id: '__ID__'}) }}"
        };
        window.translations = {
            confirm_delete: "{{ 'admin.orders.confirm_delete'|trans }}",
            error_loading: "{{ 'admin.orders.error_loading'|trans }}",
            error_deleting: "{{ 'admin.orders.error_deleting'|trans }}",
            success_deleted: "{{ 'admin.orders.success_deleted'|trans }}"
        };
    </script>
    <script src="{{ asset('js/dashboard/orders.js') }}"></script>
{% endblock %}